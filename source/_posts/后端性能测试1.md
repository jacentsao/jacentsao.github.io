---
title: 后端性能测试1
date: 2018-03-20 21:05:15
tags: [性能, 后端, 测试]
categories: 测试
---


最近在做Golang上线前的准备工作，包括部署和性能测试，本次主要记录性能测试相关的内容，以免自己遗忘。


#### ab命令行测试(Apache Benchmark)

首先想到的是简单的性能测试工具ab（Apache Benchmark），MacOS应该是自带了ab测试工具，Windows的话需要自行安装配置，可以参考一下[链接](https://stackoverflow.com/questions/7327099/how-to-install-apache-bench-on-windows-7)。

安装好ab工具以后在终端输入ab可以看到很多参数，其中常用的参数有：

* -n requests 请求次数量
* -c concurency 并发的请求数量
* -t timelimit 请求的次数限制，默认值为-n 50000
* -s timeout 请求的单次超时，默认值为30s
* -p postfile 发送文件中的请求，配合-T 使用
* -T Content-type 默认值'text/plain'

以下一个完整的ab测试post请求如下：

``` ab -n 100 -c 10 -p ./login.txt -T 'application/json' http://127.0.0.1:5174/ ```

即100次请求，并发数为10，指定当前目录下的login.txt文件中的json数据发送到服务器localhost，5174端口。以下是login.txt中的文件内容:

```
{"test":"test","cmd":"test"} 
```

##### 测试结果分析

以下是以请求百度首页模拟100人总计10000此访问来进行ab测试返回分析:

```

ab -n 10000 -c 100  https://www.baidu.com/index.html
//ApacheBenchmark软件申明
This is ApacheBench, Version 2.3 <$Revision: 1807734 $>
Copyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
Licensed to The Apache Software Foundation, http://www.apache.org/

//测试的网址
Benchmarking www.baidu.com (be patient)

//请求的进度
Completed 1000 requests
Completed 2000 requests
Completed 3000 requests
Completed 4000 requests
Completed 5000 requests
SSL handshake failed (1).
140735932269448:error:140770FC:SSL routines:SSL23_GET_SERVER_HELLO:unknown protocol:/BuildRoot/Library/Caches/com.apple.xbs/Sources/libressl/libressl-22/libressl/ssl/s23_clnt.c:565:
Completed 6000 requests
Completed 7000 requests
SSL handshake failed (1).
140735932269448:error:140770FC:SSL routines:SSL23_GET_SERVER_HELLO:unknown protocol:/BuildRoot/Library/Caches/com.apple.xbs/Sources/libressl/libressl-22/libressl/ssl/s23_clnt.c:565:
Completed 8000 requests
Completed 9000 requests
Completed 10000 requests
Finished 10000 requests

//百度的服务器软件信息
Server Software:        BWS/1.1
//被测试的主机地址
Server Hostname:        www.baidu.com
//https的默认端口
Server Port:            443
//加密协议
SSL/TLS Protocol:       TLSv1.2,ECDHE-RSA-AES128-GCM-SHA256,2048,128
//加密服务器名称
TLS Server Name:        www.baidu.com

//文档的路径
Document Path:          /index.html
//文档的大小
Document Length:        227 bytes

//并发数
Concurrency Level:      100
//测试总的时间
Time taken for tests:   146.932 seconds
//完成的请求数量
Complete requests:      10000
//失败的次数
Failed requests:        2
   (Connect: 0, Receive: 0, Length: 2, Exceptions: 0)
//总的数据传输量，包括请求头和文本内容
Total transferred:      8718256 bytes
//请求的文档总大小 227 * 10000 （总计一万次请求）- 2 * 227（两次失败）
HTML transferred:       2269546 bytes
//每秒完成的请求数量 10000/146.932
Requests per second:    68.06 [#/sec] (mean)
//每个请求的平均耗时
Time per request:       1469.317 [ms] (mean)
//服务器完成一个请求的耗时
Time per request:       14.693 [ms] (mean, across all concurrent requests)
//服务器的吞吐率
Transfer rate:          57.94 [Kbytes/sec] received


//连接信息
Connection Times (ms)
              min  mean[+/-sd] median   max
Connect:        0 1220 947.0   1170   45274
Processing:    14  234 227.0    116    2292
Waiting:       13  220 214.9    114    2291
Total:        107 1454 961.3   1301   46006

//完成请求比例的耗时，如下完成90%的耗时为1990ms
Percentage of the requests served within a certain time (ms)
  50%   1301
  66%   1377
  75%   1464
  80%   1540
  90%   1990
  95%   2221
  98%   2827
  99%   2972
 100%  46006 (longest request)
```



